---
title: 理解多租賃與並行發展
description: 瞭解利用Adobe Experience Manager資產管理多租戶實施的好處、挑戰和技術。
feature: Connected Assets
version: 6.5
topic: Development
role: Developer
level: Intermediate
exl-id: c9ee29d4-a8a5-4e61-bc99-498674887da5
source-git-commit: b069d958bbcc40c0079e87d342db6c5e53055bc7
workflow-type: tm+mt
source-wordcount: '2017'
ht-degree: 0%

---

# 理解多租賃與並行發展 {#understanding-multitenancy-and-concurrent-development}

## 簡介 {#introduction}

當多個團隊將其代碼部署到同AEM一環境時，他們應遵循一些做法，以確保團隊能夠盡可能獨立地工作，而不必踩到其他團隊的腳。 儘管這些技術永遠無法完全消除，但這些技術將最大限度地減少跨團隊的依賴性。 為了使並行開發模式成功，開發團隊之間的良好溝通至關重要。

此外，當多個開發團隊在同AEM一環境下工作時，可能會發生一定程度的多租約。 關於嘗試在環境中支援多個租戶的實際考慮AEM，特別是管理治理、運營和發展所面臨的挑戰，已經寫了很多。 本白皮書探討了在多租戶環境中實施的AEM一些技術難題，但其中許多建議將適用於具有多個開發團隊的任何組織。

必須提前指出，雖然AEM可以支援在單個環境中部署多個站點甚至多個品牌，但它不提供真正的多租賃服務。 某些環境配置和系統資源將始終共用到部署在某個環境中的所有站點。 本白皮書為最大限度地減少這些共用資源的影響提供了指導，並為簡化這些領域的溝通和協作提供了建議。

## 優勢和挑戰 {#benefits-and-challenges}

實施多租戶環境面臨許多挑戰。

這些類別包括：

* 附加的技術複雜性
* 增加開發開銷
* 共用資源的跨組織依賴關係
* 操作複雜性增加

儘管面臨種種挑戰，但運行多租戶應用程式確實有好處，例如：

* 降低硬體成本
* 縮短未來站點的上市時間
* 降低未來租戶的實施成本
* 跨整個業務的標準體系結構和開發實踐
* 一種常見的同源酶

如果企業需要真正的多租約，而對其他租戶一無所知，又不需要共用代碼、內容或共同作者，那麼單獨的作者實例是唯一可行的選擇。 應將總體發展努力的增加與基礎架構和許可證成本的節約進行比較，以確定此方法是否最合適。

## 開發技術 {#development-techniques}

### 管理依賴項 {#managing-dependencies}

在管理Maven項目依賴項時，所有團隊都必須在伺服器上使用相同版本的給定OSGi捆綁包。 為了說明當Maven項目管理不當時可能出錯的地方，我們舉了一個例子：

項目A取決於庫foo的1.0版；foo 1.0版嵌入到伺服器的部署中。 項目B取決於庫foo的1.1版；foo 1.1版嵌入到其部署中。

此外，我們假設此庫中版本1.0和1.1之間的API已發生更改。到目前為止，這兩個項目中的一個將無法正常工作。

為瞭解決這一問題，我們建議將Maven項目的所有子項目都設為一個父反應堆項目。 這個反應堆項目有兩個目的：如果需要，它允許將所有項目一起構建和部署，並包含所有子項目的依賴關係聲明。 父項目定義依賴項及其版本，而子項目僅聲明它們所需的依賴項，從父項目繼承版本。

在此方案中，如果處理項目B的團隊需要foo版本1.1中的功能，則開發環境中很快會發現此更改會中斷項目A。此時，團隊可以討論此更改，使項目A與新版本相容，或為項目B尋找替代解決方案。

請注意，這並不會消除這些團隊共用這種依賴關係的需要，它只是快速、及早地突出了問題，以便團隊可以討論任何風險並就解決方案達成一致。

### 防止代碼複製 {#preventing-code-duplication-nbsp-br}

在處理多個項目時，必須確保代碼不重複。 代碼複製增加了缺陷發生的可能性、系統更改的成本以及代碼庫的整體剛性。 為防止重複，將公共邏輯重新構建到可跨多個項目使用的可重用庫中。

為支援這一需要，我們建議開發和維護一個所有團隊都可以依賴和貢獻的核心項目。 在這樣做時，必須確保這一核心項目不再依賴於單個團隊的任何項目；這允許獨立部署，同時仍在促進代碼重用。

通常在核心模組中使用的代碼示例包括：

* 系統範圍的配置，例如：
   * OSGi配置
   * Servlet篩選器
   * 資源解析器映射
   * 吊具變壓器管道
   * 錯誤處理程式(或使用ACS公AEM域錯誤頁處理程式1)
   * 用於權限敏感快取的授權Servlet
* 實用程式類
* 核心業務邏輯
* 第三方整合邏輯
* 創作UI覆蓋
* 創作所需的其他自定義，如自定義小部件
* 工作流啟動程式
* 跨站點使用的通用設計元素

*模組化項目體系結構*

這並不意味著多個團隊需要依賴並可能更新同一組代碼。 通過建立一個核心項目，我們減少了團隊之間共用的代碼庫的規模，但並沒有消除對共用資源的需求。

為確保對此核心軟體包所做的更改不會中斷系統的功能，我們建議由高級開發人員或開發人員團隊進行監督。 一個選擇是建立一個團隊來管理對此軟體包的所有更改；另一種方法是讓團隊提交由這些資源審查和合併的拉入請求。 必須由團隊設計並同意一種治理模式，並且開發人員要遵循它。

## 管理部署範圍  {#managing-deployment-scope}

當不同的團隊將其代碼部署到同一儲存庫時，不要覆蓋彼此的更改非常重要。 具AEM有在部署內容包（篩選器）時控制此機制。 xml檔案。 濾波器之間不存在重疊是很重要的。  xml檔案，否則一個團隊的部署可能會清除另一個團隊以前的部署。 要說明這一點，請參見以下精心編製的過濾器檔案與有問題的過濾器檔案示例：

/apps/my-company與/apps/mycompany/my-site

/etc/clientlibs/my-company與/etc/clientlibs/mycompany/my-site

/etc/designs/my-company與/etc/designs/mycompany/my-site

如果每個團隊將其篩選器檔案顯式配置到他們正在處理的站點，則每個團隊都可以獨立部署其元件、客戶端庫和站點設計，而無需擦除彼此的更改。

由於它是全局系統路徑，並且不特定於一個站點，因此核心項目中應包括以下servlet，因為此處所做的更改可能會影響任何團隊：

/apps/sling/servlet/errorhandler

### 覆蓋 {#overlays}

覆蓋通常用於擴展或替換出廠時的功能AEM，但使用覆蓋會影響整個應用AEM程式（即，所有租戶都可以更改覆蓋的功能）。 如果租戶對覆蓋層的要求不同，情況就會更加複雜。 理想情況下，業務組應合作，就管理控制台的功能和外觀AEM達成一致。

如果各業務單位不能達成共識，一個可能的解決辦法就是不使用重疊。 相反，建立功能的自定義副本，並通過不同的路徑為每個租戶公開。 這允許每個租戶具有完全不同的用戶體驗，但這種方法也增加了實施和後續升級工作的成本。

### 工作流程啟動器 {#workflow-launchers}

使用AEM工作流啟動程式在儲存庫中進行指定的更改時自動觸發工作流執行。 提供AEM了幾個現成的啟動程式，例如，對新資產和更新資產執行格式副本生成和元資料提取過程。 雖然在多租戶環境中，如果租戶有不同的啟動器和/或工作流模型要求，可能會保留這些啟動器，但很可能需要為每個租戶建立和維護單個啟動器。 這些啟動程式需要配置為執行租戶的更新，同時不讓其他租戶接觸內容。 通過將啟動程式應用到特定於租戶的指定儲存庫路徑，可輕鬆完成此操作。

### 虛名 URL {#vanity-urls}

提AEM供可以按頁設定的虛榮URL功能。 在多租戶場景中，這種方法的關注點是AEM不能確保以這種方式配置的虛榮URL之間的唯一性。 如果兩個不同的用戶為不同的頁面配置了相同的虛榮路徑，則可能會遇到意外行為。 因此，我們建議在Apache調度程式實例中使用mod_rewrite規則，這允許配置中心點與僅出站資源解析程式規則一致。

### 元件組 {#component-groups}

在為多個創作組開發元件和模板時，必須有效地使用componentGroup和allowedPaths屬性。 通過有效利用網站設計，我們可以確保品牌A的作者只查看為其網站建立的元件和模板，而品牌B的作者只查看他們的元件和模板。

### 測試 {#testing}

儘管良好的體系結構和開放的通信通道有助於防止在站點意外區域引入缺陷，但這些方法並非萬無一失。 因此，在將任何內容發佈到生產環境中之前，必須充分test平台上部署的內容。 這要求各團隊在其發佈週期上進行協調，並強化了對一套自動化test的需求，這套自動化服務將盡可能多地覆蓋功能。 此外，由於一個系統由多個團隊共用，因此效能、安全性和負載測試變得比以往任何時候都更重要。

## 操作注意事項 {#operational-considerations}

### 共用資源 {#shared-resources}

在AEM單個JVM內運行；任何已AEM部署的應用程式在正常運行時已消耗的資源之外，本質上會彼此共用資AEM源。 在JVM空間本身中，線程沒有邏輯分離，並且AEM可用的有限資源也是共用的。 任何租戶消耗資源都不可避免地會影響其他系統租戶。

### 效能 {#performance}

如果不遵AEM循最佳做法，則有可能開發超出正常範圍佔用資源的應用程式。 這樣可觸發許多繁重的工作流操作（如DAM更新資產）、對許多節點使用MSM按修改操作，或使用昂貴的JCR查詢即時呈現內容。 這些將不可避免地對其他租戶應用程式的效能產生影響。

### 記錄 {#logging}

提供AEM現成介面，用於強大的記錄器配置，這些配置可用於我們在共用開發場景中的優勢。 通過為每個品牌指定單獨的日誌記錄器，通過包名，可以實現一定程度的日誌分離。 雖然複製和身份驗證等系統範圍的操作仍將記錄到中央位置，但非共用的自定義代碼可以單獨記錄，從而簡化了每個品牌技術團隊的監控和調試工作。

### 備份和還原 {#backup-and-restore}

由於JCR儲存庫的性質，傳統備份可以跨整個儲存庫工作，而不是在單個內容路徑上工作。 因此，無法根據每個租戶輕鬆地分離備份。 相反，從備份中恢復將回滾系統上所有租戶的內容和儲存庫節點。 雖然可以使用VLT等工具執行目標內容備份，或通過在單獨的環境中構建軟體包來選擇要恢復的內容，但這些\
方法不容易包含配置設定或應用程式邏輯，而且管理起來很麻煩。

## 安全注意事項 {#security-considerations}

### ACL {#acls}

當然，可以使用訪問控制清單(ACL)來控制誰有權根據內容路徑查看、建立和刪除內容，這需要建立和管理用戶組。 維護ACL和組的難度取決於強調確保每個租戶對其他租戶沒有任何瞭解，以及部署的應用程式是否依賴共用資源。 為確保高效的ACL 、用戶和組管理，我們建議由一個集中的組進行必要的監督，以確保這些訪問控制和承擔者以提高效率和安全性的方式重疊（或不重疊）。
